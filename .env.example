# ==============================================================================
# OpenMiner - Example .env
#
# Copy this file to .env and fill in secrets locally.
# IMPORTANT: Do NOT commit .env (it contains secrets).
# ==============================================================================

# ==============================================================================
# App settings
# ==============================================================================
DEBUG=True
FORCE_OCR=True
GENERATE_SEARCHABLE_PDF=True
MAX_CONCURRENT_JOBS=1
INIT_MINERU_ON_STARTUP=No

# ==============================================================================
# Output folders (optional)
# - Relative paths are resolved relative to the project root.
# - JSON output folder key is JSON_OUTPUT_DIR (preferred).
# - OUTPUT_DIR is supported for backward compatibility, but JSON_OUTPUT_DIR is recommended.
# ==============================================================================
UPLOAD_DIR=uploads
JSON_OUTPUT_DIR=outputs
CSV_OUTPUT_DIR=outputs
MINERU_OUTPUT_DIR=mineru_outputs
SHAREPOINT_DOWNLOAD_DIR=sharepoint_downloads
STATIC_DIR=static

# ==================================================================
# Searchable PDF (OCRmyPDF) settings
# - These apply when FORCE_OCR=True or when the PDF is detected as needing OCR.
# - OCR_FORCE_REDO=True forces OCR even if the PDF already has a text layer.
# - OCR_ROTATE_PAGES=True enables auto-rotation (uses Tesseract OSD).
# ==================================================================
# Multiple languages supported with + separator
# Language codes: eng, chi_tra (Traditional Chinese), chi_sim (Simplified Chinese), fra, deu, spa
OCR_LANGUAGE=eng+chi_tra+chi_sim+fra+deu+spa
# Optional: assume this DPI when input pages lack DPI metadata (OCRmyPDF image_dpi)
# Common values: 200, 300, 600
OCR_IMAGE_DPI=
OCR_ROTATE_PAGES=True
# Rotation confidence threshold (0.0-15.0). Lower = more aggressive rotation.
# Default ocrmypdf threshold is ~14. Set to 5.0 to allow rotation for pages with lower confidence.
# Leave empty to use ocrmypdf default.
OCR_ROTATE_THRESHOLD=5.0
OCR_DESKEW=False
OCR_JOBS=1
OCR_OPTIMIZE=0
OCR_FORCE_REDO=False

# If you see errors like:
#   [tesseract] read_params_file: Can't open hocr
#   [tesseract] read_params_file: Can't open txt
# set this to your tessdata folder (or its parent).
# Examples:
#   OCR_TESSDATA_PREFIX=C:\Program Files\Tesseract-OCR\tessdata
#   OCR_TESSDATA_PREFIX=C:\Program Files\Tesseract-OCR
OCR_TESSDATA_PREFIX=

# ==============================================================================
# AI service selection
# ==============================================================================
AI_SERVICE=azure_openai  # azure_openai or ollama
JSON_GENERATION_METHOD=azure_openai_json # mineru_json, azure_openai_json, program_json (legacy: *_csv)

# ==============================================================================
# Azure OpenAI settings (required when AI_SERVICE=azure_openai)
# ==============================================================================
AZURE_OPENAI_API_KEY=
AZURE_OPENAI_ENDPOINT=https://openai-westus.openai.azure.com
AZURE_OPENAI_DEPLOYMENT_NAME=Extgpt-4.1
AZURE_OPENAI_API_VERSION=2025-01-01-preview
AZURE_OPENAI_TEMPERATURE=0

# Optional prompt overrides (frontend UI can override these too)
AZURE_OPENAI_SYSTEM_PROMPT=
AZURE_OPENAI_USER_PROMPT=

# ==============================================================================
# Ollama settings (required when AI_SERVICE=ollama)
# ==============================================================================
OLLAMA_BASE_URL=http://localhost:11434
OLLAMA_MODEL=deepseek-r1:8b  # 可選：gemma3:1b 或 deepseek-r1:8b
OLLAMA_TIMEOUT=2000  # Ollama API 超時時間（秒）
OLLAMA_TEMPERATURE=0

# ==============================================================================
# MinerU settings
# ==============================================================================
MINERU_CMD=mineru
MINERU_METHOD=auto
MINERU_OUTPUT_SOURCE=json  # json | layout_pdf | span_pdf | both_pdf
USE_VLLM_ASYNC=True
MINERU_MODEL_NAME=opendatalab/MinerU2.5-2509-1.2B
MINERU_DEVICE=cpu

# Header/footer handling
MINERU_INCLUDE_HEADER_ZONES=True
MINERU_HEADER_ZONE_RATIO=0.01 # 頁面頂部 1% 作為標題區域
MINERU_INCLUDE_PDF_TEXT_LAYER=True
MINERU_PDF_TEXT_LAYER_MAX_LINES=300

# ==============================================================================
# SharePoint settings (optional)
# ==============================================================================
SHAREPOINT_CLIENT_ID=
SHAREPOINT_TENANT_ID=
SHAREPOINT_CLIENT_SECRET=
# Legacy/back-compat keys (supported by services/sharepoint_service.py)
# Prefer SHAREPOINT_CLIENT_SECRET + SHAREPOINT_TENANT_ID.
SHAREPOINT_SECRET=
SHAREPOINT_TENANT=
# Optional: full SharePoint link to derive SHAREPOINT_SITE_URL automatically
# (useful when pasting a library/file URL from the browser)
SHAREPOINT_LINK=
# Use the SharePoint *site root* URL here (no spaces). Avoid library view URLs like ".../Shared Documents/Forms/AllItems.aspx"
# because unquoted spaces can break .env parsing.
SHAREPOINT_SITE_URL=https://jebsengroup.sharepoint.com/sites/APOCR
SHAREPOINT_FOLDER=
SHAREPOINT_POLL_INTERVAL=60  # in seconds

# ==================================================================
# Backend server settings (optional)
# ==================================================================
APP_HOST=localhost
APP_PORT=8000

# ==================================================================
# Searchable PDF output options (optional)
# ==================================================================
# Folder to write searchable PDFs (defaults to JSON_OUTPUT_DIR)
SEARCHABLE_PDF_OUTPUT_DIR=outputs
# Opacity for the embedded searchable text layer (0.0–1.0)
SEARCHABLE_PDF_TEXT_OPACITY=0.01
# Optional font path to embed for better Unicode search/copy
SEARCHABLE_PDF_FONT_PATH=

# ==================================================================
# Azure OpenAI advanced / multimodal options (optional)
# ==================================================================
# If enabled, sends MinerU JSON + rendered PDF page images to Azure OpenAI.
AZURE_OPENAI_INCLUDE_IMAGES=True
# 0 = send all pages
AZURE_OPENAI_IMAGE_MAX_PAGES=0
# 0 = do not resize; otherwise longest side in pixels
AZURE_OPENAI_IMAGE_MAX_SIDE=1280
# jpeg or png
AZURE_OPENAI_IMAGE_FORMAT=jpeg

# If enabled, appends full raw MinerU JSON into the user prompt.
AZURE_OPENAI_INCLUDE_RAW_MINERU_JSON=True
# 0 = no limit; otherwise truncate raw JSON to this many characters
AZURE_OPENAI_RAW_JSON_MAX_CHARS=0

# Optional: legacy/custom prompt (generally replaced by System/User prompt fields)
# Use \n for newlines.
AZURE_OPENAI_CUSTOM_PROMPT=

# ==================================================================
# App safety/testing options (optional)
# ==================================================================
# If True, allows returning mocked MinerU/OCR output when MinerU fails (testing only; disable in production)
ALLOW_MOCK_MINERU_OUTPUT=False

# ==================================================================
# MinerU additional options (optional)
# ==================================================================
# MinerU JSON variant selection (when MINERU_OUTPUT_SOURCE=json)
# content_list (default) -> *_content_list.json
# middle -> *_middle.json
# model -> *_model.json
MINERU_JSON_VARIANT=content_list

# Header/footer handling
MINERU_INCLUDE_HEADER_ZONES=True
MINERU_HEADER_ZONE_RATIO=0.12
MINERU_INCLUDE_PDF_TEXT_LAYER=True
MINERU_PDF_TEXT_LAYER_MAX_LINES=300

# ==================================================================
# Misc limits (optional)
# ==================================================================
# Used by Azure AI service input sizing; bytes
MAX_CONTENT_LENGTH=500000
NETWORK_SHARE_DIR=\\localhost\share